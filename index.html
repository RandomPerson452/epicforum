<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Mini Forum</title>
  <style>
    body { font-family: sans-serif; max-width: 600px; margin: auto; padding: 20px; }
    textarea { width: 100%; height: 80px; }
    .post { border-bottom: 1px solid #ddd; padding: 8px 0; }
  </style>
</head>
<body>
  <h2>Forum</h2>

  <form id="post-form">
    <input type="text" id="username" placeholder="Enter your name" required><br><br>
    <textarea id="content" placeholder="Type your message..." required></textarea><br><br>
    <button type="submit">Send</button>
  </form>

  <h3>Posts:</h3>
  <div id="posts"></div>

  <script>
    const postsDiv = document.getElementById('posts')
    const form = document.getElementById('post-form')

    async function loadPosts() {
      const res = await fetch('/.netlify/functions/getPosts')
      const posts = await res.json()
      postsDiv.innerHTML = posts.map(p => `<div class="post"><b>${p.username}</b>: ${p.content}</div>`).join('')
    }

    form.addEventListener('submit', async e => {
      e.preventDefault()
      const username = document.getElementById('username').value
      const content = document.getElementById('content').value

      await fetch('/.netlify/functions/addPost', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ username, content })
      })

      document.getElementById('content').value = ''
      loadPosts()
    })

    loadPosts()
  </script>
</body>
</html>
